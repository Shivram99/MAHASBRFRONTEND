<div class="bglightblue py-3">
  <div class="container bg-white shadow rounded p-3">

    <div class="d-md-flex justify-content-between border-b-org p-3">
      <h1>{{ 'ReqForm.title' | translate }}</h1>

      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a routerLink="/">{{ 'ReqForm.breadcrumb_home' | translate }}</a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            {{ 'ReqForm.breadcrumb_form' | translate }}
          </li>
        </ol>
      </nav>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-7 col-md-9 mt-2">

        <!-- Success Message -->
        @if (requestId) {
          <div class="alert alert-success text-center mt-4">
            {{ 'ReqForm.success_msg' | translate }}<br>
            <strong>{{ 'ReqForm.success_id' | translate }}: {{ requestId }}</strong>
          </div>
        }

        <!-- FORM SECTION -->
        @if (!showPreview) {
          <div class="card shadow border-0 rounded-3">
            <div class="card-body p-4">
              <form [formGroup]="requestForm" (ngSubmit)="onSubmit()">
                <!-- Name -->
                <div class="mb-3">
                  <label class="form-label bold">{{ 'ReqForm.name' | translate }} *</label>
                  <input type="text" class="form-control" formControlName="name">
                  @if (f['name'].touched && f['name'].invalid) {
                    <div class="text-danger small mt-1">
                      @if (f['name'].errors?.['required']) {
                        <div>
                          {{ 'ReqForm.name_req' | translate }}
                        </div>
                      }
                      @if (f['name'].errors?.['maxlength']) {
                        <div>
                          {{ 'ReqForm.name_max' | translate }}
                        </div>
                      }
                    </div>
                  }
                </div>
                <!-- District -->
                <div class="mb-3">
                  <label class="form-label bold">{{ 'ReqForm.district' | translate }} *</label>
                  <select class="form-select" formControlName="district">
                    <option value="-1">{{ 'ReqForm.district_select' | translate }}</option>
                    @for (district of districts; track district) {
                      <option
                        [value]="district.districtName">
                        {{ district.districtName | capitalize }}
                      </option>
                    }
                  </select>
                  @if (f['district'].touched && f['district'].invalid) {
                    <div class="text-danger small mt-1">
                      @if (f['district'].errors?.['required']) {
                        <div>
                          {{ 'ReqForm.district_req' | translate }}
                        </div>
                      }
                    </div>
                  }
                </div>
                <!-- Email -->
                <div class="mb-3">
                  <label class="form-label bold">{{ 'ReqForm.email' | translate }} *</label>
                  <input type="email" class="form-control" formControlName="email">
                  @if (f['email'].touched && f['email'].invalid) {
                    <div class="text-danger small mt-1">
                      @if (f['email'].errors?.['required']) {
                        <div>
                          {{ 'ReqForm.email_req' | translate }}
                        </div>
                      }
                      @if (f['email'].errors?.['email']) {
                        <div>
                          {{ 'ReqForm.email_valid' | translate }}
                        </div>
                      }
                      @if (f['email'].errors?.['maxlength']) {
                        <div>
                          {{ 'ReqForm.email_max' | translate }}
                        </div>
                      }
                    </div>
                  }
                </div>
                <!-- Mobile -->
                <div class="mb-3">
                  <label class="form-label bold">{{ 'ReqForm.mobile' | translate }} *</label>
                  <input type="text" maxlength="10" class="form-control" formControlName="mobile">
                  @if (f['mobile'].touched && f['mobile'].invalid) {
                    <div class="text-danger small mt-1">
                      @if (f['mobile'].errors?.['required']) {
                        <div>
                          {{ 'ReqForm.mobile_req' | translate }}
                        </div>
                      }
                      @if (f['mobile'].errors?.['pattern']) {
                        <div>
                          {{ 'ReqForm.mobile_valid' | translate }}
                        </div>
                      }
                    </div>
                  }
                </div>
                <!-- Message -->
                <div class="mb-3">
                  <label class="form-label bold">{{ 'ReqForm.message' | translate }} *</label>
                  <textarea rows="4" class="form-control" formControlName="message"></textarea>
                  @if (f['message'].touched && f['message'].invalid) {
                    <div class="text-danger small mt-1">
                      @if (f['message'].errors?.['required']) {
                        <div>
                          {{ 'ReqForm.message_req' | translate }}
                        </div>
                      }
                      @if (f['message'].errors?.['maxlength']) {
                        <div>
                          {{ 'ReqForm.message_max' | translate }}
                        </div>
                      }
                    </div>
                  }
                </div>
                <!-- Submit -->
                <button type="submit" class="btn btn-primary w-100 py-2"
                  [disabled]="submitting || requestForm.invalid">
                  {{ submitting ? ('ReqForm.submitting' | translate) : ('ReqForm.submit' | translate) }}
                </button>
              </form>
            </div>
          </div>
        }

        <!-- PREVIEW SECTION -->
        @if (showPreview) {
          <div class="card shadow border-0 rounded-3 mt-3">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">{{ 'ReqForm.preview_title' | translate }}</h5>
            </div>
            <div class="card-body p-4">
              <p><strong>{{ 'ReqForm.name' | translate }}:</strong> {{ requestForm.value.name }}</p>
              <p><strong>{{ 'ReqForm.district' | translate }}:</strong> {{ requestForm.value.district }}</p>
              <p><strong>{{ 'ReqForm.email' | translate }}:</strong> {{ requestForm.value.email }}</p>
              <p><strong>{{ 'ReqForm.mobile' | translate }}:</strong> {{ requestForm.value.mobile }}</p>
              <p><strong>{{ 'ReqForm.message' | translate }}:</strong></p>
              <div class="border rounded p-2 bg-light">
                {{ requestForm.value.message }}
              </div>
              <div class="text-center mt-4">
                <button class="btn btn-secondary me-2 px-4" (click)="editDetails()">
                  {{ 'ReqForm.edit' | translate }}
                </button>
                <button class="btn btn-success px-4" (click)="confirmSubmit()" [disabled]="submitting">
                  {{ submitting ? ('ReqForm.submitting' | translate) : ('ReqForm.confirm_submit' | translate) }}
                </button>
              </div>
            </div>
          </div>
        }

      </div>
    </div>

  </div>
</div>
